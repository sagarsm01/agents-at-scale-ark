FROM node:22-alpine

WORKDIR /app

# Copy package files
COPY package*.json tsconfig.json ./

# Install dependencies (npm ci uses package-lock.json for reproducible builds)
RUN npm ci --only=production=false

# Copy source code
COPY src ./src

# Build the TypeScript project
RUN npm run build

# Create non-root user
RUN addgroup -S mcp && adduser -S -G mcp mcp && \
    mkdir -p /data/sessions && \
    chown -R mcp:mcp /app /data

USER mcp

EXPOSE 8080

CMD ["node", "dist/index.js"]

